<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vanilla Crud</title>
</head>

<body>
  <div id="todo-list">
    Loading...
  </div>

  <br>

  <iframe name="hiddenFrame" style="display:none;" onload="fetchTodos()"></iframe>

  <form action="/api/todo" method="post" target="hiddenFrame">
    <input type="text" name="name" required>
    <button type="submit">Add</button>
  </form>

  <script>
    const todoList = document.getElementById('todo-list');
    const nameInput = document.querySelector('input[name="name"]');

    const fetchTodos = async () => {
      nameInput.value = '';
      const response = await fetch('/api/todo', {
        cache: "reload"
      });
      const todos = await response.json();

      if (todos.length === 0) {
        todoList.innerHTML = 'No todos';
        return;
      }

      todoList.innerHTML = todos.map(todo => `<div>  
          <button onclick="deleteTodo(${todo.id})">x</button>
        ${todo.name}
      </div>`).join('');
    };

    const deleteTodo = async (id) => {
      await fetch(`/api/todo/${id}`, {
        method: 'DELETE'
      });
      fetchTodos();
    };

  </script>
</body>

</html>